---
title: "Indicator Normalizations"
output: html_document
date: "2022-11-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
```

# Surf Spots

# Pressure Index

```{r}
built_area <- read_csv(here("data", "pressure", "built_area.csv")) %>% 
  select(id, Shape_Area, SUM_Area_S) %>% 
  clean_names() %>% 
  mutate(sum_area_sqkm = sum_area_s) %>% 
  select(-sum_area_s)
human_mod <- read_csv(here("data", "pressure", "human_mod.csv")) %>% 
  select(id, MEAN) %>% 
  clean_names()
pop <- read_csv(here("data", "pressure", "pop.csv")) %>% 
  select(id, pop_change) %>% 
  clean_names()
ports <- read_csv(here("data", "pressure", "ports.csv")) %>% 
  select(id, Join_Count) %>% 
  clean_names()
roads <- read_csv(here("data", "pressure", "roads.csv")) %>% 
  select(id, SUM_Length) %>% 
  clean_names() %>% 
  mutate(sum_length_km = sum_length) %>% 
  select(-sum_length)
```

## Built Area

```{r}
built_area <- built_area %>% 
  mutate(percent_ba = round(sum_area_sqkm / (shape_area / 1000000), 10))

max_percent_ba <- round(max(built_area$percent_ba), 10)
min_percent_ba <- round(min(built_area$percent_ba), 10)

built_area <- built_area %>% 
  mutate(normalized_built_area = round((percent_ba - min_percent_ba) /
                                         (max_percent_ba - min_percent_ba), 10))
```

## Human Modification

```{r}
max_human_mod <- round(max(human_mod$mean), 10)
min_human_mod <- round(min(human_mod$mean), 10)

human_mod <- human_mod %>% 
  mutate(normalized_human_mod = round((mean - min_human_mod) /
                                        (max_human_mod - min_human_mod), 10))
```

## Population

```{r}
max_pop_change <- round(max(pop$pop_change), 10)
min_pop_change <- round(min(pop$pop_change), 10)

pop <- pop %>% 
  mutate(normalized_pop_change = round((pop_change - min_pop_change) /
                                         (max_pop_change - min_pop_change), 10))
```

## Ports

```{r}
max_ports <- round(max(ports$join_count), 10)
min_ports <- round(min(ports$join_count), 10)

ports <- ports %>% 
  mutate(normalized_ports = round((join_count - min_ports) /
                                    (max_ports - min_ports), 10))
```

## Roads

```{r}
max_road <- round(max(roads$sum_length_km), 10)
min_road <- round(min(roads$sum_length_km), 10)

roads <- roads %>% 
  mutate(normalized_roads = round((sum_length_km - min_road) /
                                    (max_road - min_road), 10))
```

## Merge Pressure Indicators

```{r}
ba_mod_join <- left_join(built_area, human_mod, 
                         by = "id") %>% 
  select(-shape_area, -sum_area_sqkm, -percent_ba, -mean)

ba_mod_pop <- left_join(ba_mod_join, pop,
                        by = "id") %>% 
  select(-pop_change)

ba_mod_pop_ports <- left_join(ba_mod_pop, ports,
                              by = "id") %>% 
  select(-join_count)

pressure_normalized <- left_join(ba_mod_pop_ports, roads,
                                 by = "id") %>% 
  select(-sum_length_km)
```

## Normalize Pressure Index

```{r}
pressure_normalized <- pressure_normalized %>% 
  mutate(added_pressure = round(normalized_built_area + normalized_human_mod +
                                  normalized_pop_change + normalized_ports +
                                  normalized_roads, 10))

max_pressure <- round(max(pressure_normalized$added_pressure), 10)
min_pressure <- round(min(pressure_normalized$added_pressure), 10)

pressure_normalized <- pressure_normalized %>% 
  mutate(pressure_index = round((added_pressure - min_pressure) /
                                  (max_pressure - min_pressure), 10))
```

## Export Pressure Index

```{r}
write_csv(pressure_normalized, file = "normalized_pressure.csv")
```

# Social Index

## Biodiversity Sub Index

```{r}
marine_richness <- read_csv(here("data", "biodiversity", "marine_richness.csv")) %>% 
  select(OBJECTID, MEAN) %>% 
  clean_names()
terr_richness <- read_csv(here("data", "biodiversity", "terr_richness.csv")) %>% 
  select(OBJECTID, MEAN) %>% 
  clean_names()
coral <- read_csv(here("data", "biodiversity", "coral_reef.csv")) %>% 
  select(OBJECTID, coral_reef) %>% 
  clean_names()
mangrove <- read_csv(here("data", "biodiversity", "mangrove.csv")) %>% 
  select(OBJECTID, mangrove_p) %>% 
  clean_names()
seagrass <- read_csv(here("data", "biodiversity", "seagrass.csv")) %>% 
  select(OBJECTID, Join_Count) %>% 
  clean_names()
tree_cover <- read_csv(here("data", "biodiversity", "tree_cover.csv")) %>% 
  select(OBJECTID, MEAN) %>% 
  clean_names()
terr_pa_high <- read_csv(here("data", "biodiversity", "terr_pa_high.csv")) %>% 
  select(OBJECTID, high_perce) %>% 
  clean_names()
terr_pa_ver_high <- read_csv(here("data", "biodiversity", "terr_pa_very_high.csv")) %>% 
  select(OBJECTID, very_high_) %>% 
  clean_names()
terr_pa_ext_high <- read_csv(here("data", "biodiversity", "terr_pa_extremely_high.csv")) %>% 
  select(OBJECTID, extremely_) %>% 
  clean_names()
ocean_pa <- read_csv(here("data", "biodiversity", "oceanic_pa.csv")) %>% 
  select(OBJECTID, oceanic_pa) %>% 
  clean_names()
```

### Species Biodiversity

```{r}
# terrestrial species
max_terr_rich <- round(max(terr_richness$mean), 10)
min_terr_rich <- round(min(terr_richness$mean), 10)

terr_richness <- terr_richness %>% 
  mutate(normalized_terr_rich = round((mean - min_terr_rich) / 
                                        (max_terr_rich - min_terr_rich), 10))

# marine species
max_marine_rich <- round(max(marine_richness$mean), 10)
min_marine_rich <- round(min(marine_richness$mean), 10)

marine_richness <- marine_richness %>% 
  mutate(normalized_mar_rich = round((mean - min_marine_rich) /
                                       (max_marine_rich - min_marine_rich), 10))

# join terrestrial and marine species richness
species_richness <- left_join(terr_richness, marine_richness,
                              by = "objectid") %>% 
  select(objectid, normalized_terr_rich, normalized_mar_rich)
```

### Ecosystem Biodiversity

```{r}
# marine ecosystems
max_coral <- round(max(coral$coral_reef), 10)
min_coral <- round(min(coral$coral_reef), 10)

coral <- coral %>% 
  mutate(normalized_coral_reef = round((coral_reef - min_coral) /
                                          (max_coral - min_coral), 10))

max_mangrove <- round(max(mangrove$mangrove_p), 10)
min_mangrove <- round(min(mangrove$mangrove_p), 10)

mangrove <- mangrove %>% 
  mutate(normalized_mangrove = round((mangrove_p - min_mangrove) /
                                       (max_mangrove - min_mangrove), 10))

max_seagrass <- round(max(seagrass$join_count), 10)
min_seagrass <- round(min(seagrass$join_count), 10)

seagrass <- seagrass %>% 
  mutate(normalized_seagrass = round((join_count - min_seagrass) /
                                       (max_seagrass - min_seagrass), 10))

# terrestrial ecosystems
max_tree_cover <- round(max(tree_cover$mean), 10)
min_tree_cover <- round(min(tree_cover$mean), 10)

tree_cover <- tree_cover %>% 
  mutate(normalized_tree_cover = round((mean - min_tree_cover) /
                                         (max_tree_cover - min_tree_cover), 10))
```

#### Marine Ecosystem Biodiversity Weighted (& Normalized)

```{r}
marine_two_eco_weighted <- left_join(coral, seagrass,
                                 by= "objectid") %>% 
  select(-coral_reef, -join_count)

marine_eco_weighted <- left_join(marine_two_eco_weighted, mangrove,
                                 by = "objectid") %>% 
  select(-mangrove_p)

# weight marine ecosystems
marine_eco_weighted <- marine_eco_weighted %>% 
  mutate(marine_eco_added = round((normalized_coral_reef + normalized_mangrove + normalized_seagrass), 10))

# normalize weighted marine areas
max_added_marine_eco <- round(max(marine_eco_weighted$marine_eco_added), 10)
min_added_marine_eco <- round(min(marine_eco_weighted$marine_eco_added), 10)

marine_eco_weighted <- marine_eco_weighted %>% 
  mutate(normalized_marine_eco = round((marine_eco_added - min_added_marine_eco) /
                                         (max_added_marine_eco - min_added_marine_eco), 10))
```

### Priority Areas (& Weighted)

```{r}
# high priority terrestrial areas weighted
terr_pa_high <- terr_pa_high %>% 
  mutate(terr_pa_high_weighted = round(terr_pa_high$high_perce * 0.3333, 10))

max_terr_pa_high <- round(max(terr_pa_high$terr_pa_high_weighted), 10)
min_terr_pa_high <- round(min(terr_pa_high$terr_pa_high_weighted), 10)

terr_pa_high <- terr_pa_high %>% 
  mutate(normalized_terr_pa_high = round((terr_pa_high_weighted - min_terr_pa_high) /
                                           (max_terr_pa_high - min_terr_pa_high), 10))

# very high priority terrestrial areas weighted
terr_pa_ver_high <- terr_pa_ver_high %>% 
  mutate(terr_pa_ver_high_weighted = round(very_high * 0.6666, 10))

max_terr_pa_very_high <- round(max(terr_pa_ver_high$terr_pa_ver_high_weighted), 10)
min_terr_pa_very_high <- round(min(terr_pa_ver_high$terr_pa_ver_high_weighted), 10)

terr_pa_ver_high <- terr_pa_ver_high %>% 
  mutate(normalized_terr_pa_ver_high = round((terr_pa_ver_high_weighted - min_terr_pa_very_high) /
                                           (max_terr_pa_very_high - min_terr_pa_very_high), 10))

# extremely high priority terrestrial areas weighted
max_terr_pa_ext_high <- round(max(terr_pa_ext_high$extremely), 10)
min_terr_pa_ext_high <- round(min(terr_pa_ext_high$extremely), 10)

terr_pa_ext_high <- terr_pa_ext_high %>% 
  mutate(normalized_terr_pa_ext_high = round((extremely - min_terr_pa_ext_high) /
                                           (max_terr_pa_ext_high - min_terr_pa_ext_high), 10))

# oceanic priority areas
max_oceanic_pa <- round(max(ocean_pa$oceanic_pa), 10)
min_oceanic_pa <- round(min(ocean_pa$oceanic_pa), 10)

ocean_pa <- ocean_pa %>% 
  mutate(normalized_ocean_pa = round((oceanic_pa - min_oceanic_pa) /
                                       (max_oceanic_pa - min_oceanic_pa), 10))

# join terrestrial priority areas
two_terr_pa <- left_join(terr_pa_high, terr_pa_ver_high,
                    by = "objectid")
  
terr_pa <- left_join(two_terr_pa, terr_pa_ext_high,
                     by = "objectid")

# normalize all terrestrial priority areas
terr_pa <- terr_pa %>% 
  mutate(added_terr_pa = round(normalized_terr_pa_high + normalized_terr_pa_ver_high + normalized_terr_pa_ext_high, 10))

max_terr_pa <- round(max(terr_pa$added_terr_pa), 10)
min_terr_pa <- round(min(terr_pa$added_terr_pa), 10)

terr_pa <- terr_pa %>% 
  mutate(normalized_terr_pa = round((added_terr_pa - min_terr_pa) /
                                      (max_terr_pa - min_terr_pa), 10))

# join oceanic priority areas to all terrestrial priority areas
all_pa <- left_join(terr_pa, ocean_pa,
                    by = "objectid")
```

### Merge Biodiversity Indicators

```{r}
mar_eco_rich <- left_join(species_richness, marine_eco_weighted,
                          by = "objectid")

plus_pa <- left_join(mar_eco_rich, all_pa,
                     by = "objectid")

biodiversity_normalized <- left_join(plus_pa, tree_cover,
                                     by = "objectid")
```

### Normalize Biodiversity Subindex

```{r}
biodiversity_normalized <- biodiversity_normalized %>% 
  mutate(added_biodiversity = round(normalized_terr_rich + normalized_mar_rich +
                                      normalized_marine_eco + normalized_terr_pa +
                                      normalized_ocean_pa + normalized_tree_cover, 10))

max_added_biod <- round(max(biodiversity_normalized$added_biodiversity), 10)
min_added_biod <- round(min(biodiversity_normalized$added_biodiversity), 10)

biodiversity_normalized <- biodiversity_normalized %>% 
  mutate(biodiversity_subindex = round((added_biodiversity - min_added_biod) /
                                         (max_added_biod - min_added_biod), 10))
```

### Export Normalized Biodiverstiy Subindex

```{r}
write_csv(biodiversity_normalized, file = "normalized_biodiversity.csv")
```

## Surf Subindex

```{r}
# read in data
surf_indicators <- read_csv(here("data", "surf", "surf_indicators.csv")) %>% 
  select(OBJECTID, Join_Count, numerical_, numerical1, numerica_1, numerica_2) %>% 
  clean_names()

surf_indicators <- surf_indicators %>% 
  mutate(numerical_direction = numerical) %>% 
  mutate(numerical_frequency = numerical1) %>% 
  mutate(numerical_experience = numerica_1) %>% 
  mutate(numerical_quality = numerica_2) %>% 
  select(-numerical, -numerical1, 
         -numerica_1, -numerica_2)
```

### Surf Clusters

```{r}
max_cluster <- round(max(surf_indicators$join_count), 10)
min_cluster <- round(min(surf_indicators$join_count), 10)

surf_indicators <- surf_indicators %>% 
  mutate(normalized_clusters =  round((join_count - min_cluster) / 
                              (max_cluster - min_cluster), 6))
```

### Direction

```{r}
surf_indicators <- surf_indicators %>% 
  mutate(normalized_direction = numerical_direction)
```

### Frequency

```{r}
max_frequency <- round(max(surf_indicators$numerical_frequency), 10)
min_frequency <- round(min(surf_indicators$numerical_frequency), 10)

surf_indicators <- surf_indicators %>% 
  mutate(normalized_frequency = round((numerical_frequency - min_frequency) / 
                                (max_frequency - min_frequency), 10))
```

### Experience

```{r}
surf_indicators <- surf_indicators %>% 
  mutate(normalized_experience = numerical_experience)
```

### Quality

```{r}
max_quality <- round(max(surf_indicators$numerical_quality), 10)
min_quality <- round(min(surf_indicators$numerical_quality), 10)

surf_indicators <- surf_indicators %>% 
  mutate(normalized_quality = round((numerical_quality - min_quality) / 
                              (max_quality - min_quality), 10))
```

## Normalized Surf Subindex

```{r}
surf_normalized <- surf_indicators %>% 
  mutate(added_surf = round(normalized_quality + normalized_experience + 
                              normalized_frequency + normalized_direction +
                              normalized_clusters, 10))

max_added <- round(max(surf_normalized$added_surf), 10)
min_added <- round(min(surf_normalized$added_surf), 10)

surf_normalized <- surf_normalized %>% 
  mutate(surf_subindex = round((added_surf - min_added) / 
                           (max_added - min_added), 10))
```

## Surf Subindex Export

```{r}
write_csv(surf_normalized, file = "normalized_surf.csv")
```

## Social Subindex

```{r}
employment <- read_csv(here("data", "social", "SLR_employment.csv")) %>% 
  select(OBJECTID, Join_Count, Name, Surf_Spot, SLR_employ) %>% 
  clean_names()
hotels <- read_csv(here("data", "social", "hotels.csv")) %>% 
  select(OBJECTID, Join_Count, Name, Surf_Spot) %>% 
  clean_names()
airports <- read_csv(here("data", "social", "airports.csv")) %>% 
  select(OBJECTID, Join_Count, Name, Surf_Spot) %>% 
  clean_names()
```

### Employment

```{r}
max_employment <- round(max(employment$slr_employ), 10)
min_employment <- round(min(employment$slr_employ), 10)

employment <- employment %>% 
  mutate(normalized_employment = round((employment$slr_employ - min_employment) /
                                         (max_employment - min_employment), 10))
```

### Hotels

```{r}
max_hotel <- round(max(hotels$join_count), 10)
min_hotel <- round(min(hotels$join_count), 10)

hotels <- hotels %>% 
  mutate(normalized_hotels = round((hotels$join_count - min_hotel) /
                                     (max_hotel - min_hotel), 10))
```

### Airports

```{r}
max_airport <- round(max(airports$join_count), 10)
min_airport <- round(min(airports$join_count), 10)

airports <- airports %>% 
  mutate(normalized_airports = round((airports$join_count - min_airport) /
                                       (max_airport - min_airport), 10))
```

### Merge Social Index Indicators

```{r}
social_normalized <- left_join(employment, hotels, 
                               by = "objectid") %>% 
  select(objectid, name.x, surf_spot.x, 
         normalized_employment, normalized_hotels)

social_normalized <- left_join(social_normalized, airports,
                               by = "objectid") %>% 
  select(objectid, name.x, surf_spot.x, 
         normalized_employment, normalized_hotels, normalized_airports)
```

### Normalized Social Subindex

```{r}
social_normalized <- social_normalized %>% 
  mutate(social_added = round(normalized_employment + normalized_hotels + normalized_airports, 10))

max_social_added <- round(max(social_normalized$social_added), 10)
min_social_added <- round(min(social_normalized$social_added), 10)

social_normalized <- social_normalized %>% 
  mutate(social_subindex = round((social_normalized$social_added - min_social_added) /
                                   (max_social_added - min_social_added), 10))
```

### Export Social Subindex

```{r}
write_csv(social_normalized, file = "normalized_social.csv")
```

# Response Index

```{r}
heritage <- read_csv(here("data", "response", "heritage_surf.csv")) %>% 
  select(OBJECTID, Name, Surfline_n, Shape_Leng, Shape_Area, SUM_Area_S, world_heri) %>% 
  clean_names()
atl_for_priority <- read_csv(here("data", "response", "priority_area_surf.csv")) %>% 
  select(OBJECTID, Name, Surfline_n, Shape_Leng, Shape_Area, SUM_Area_S, protected_) %>% 
  clean_names()
guarda <- read_csv(here("data", "response", "wsr_surf.csv")) %>% 
  select(OBJECTID, Name, Surfline_n, Shape_Leng, Shape_Area, SUM_Area_S, wsr_percen) %>% 
  clean_names()
prot_areas <- read_csv(here("data", "response", "protected_surf.csv")) %>% 
  select(OBJECTID, Name, Surfline_n, Shape_Leng, Shape_Area, SUM_Area_S, protected_) %>% 
  clean_names()
bandeira <- read_csv(here("data", "response", "bandeira_surf.csv")) %>% 
  select(OBJECTID, Join_Count, Name, Surfline_n) %>% 
  clean_names()
ramsar <- read_csv(here("data", "response", "ramsar_surf.csv")) %>% 
  select(OBJECTID, Name, Surfline_n, Shape_Leng, Shape_Area, SUM_Area_S, ramsar_per) %>% 
  clean_names()
```

## World Heritage Sites

```{r}
max_heritage <- round(max(heritage$world_heri), 10)
min_heritage <- round(min(heritage$world_heri), 10)

heritage_normalized <- round((heritage$world_heri - min_heritage) / 
                               (max_heritage - min_heritage), 10)

heritage$normalized_heritage <- heritage_normalized
```

## Atlantic Forest Priority Areas

```{r}
max_priority <- round(max(atl_for_priority$protected), 10)
min_priority <- round(min(atl_for_priority$protected), 10)

priority_normalized <- round((atl_for_priority$protected - min_priority) / 
                               (max_priority - min_priority), 10)

atl_for_priority$normalized_priority <- priority_normalized
```

## Guarda World Surfing Reserve

```{r}
max_wsr <- round(max(guarda$wsr_percen), 10)
min_wsr <- round(min(guarda$wsr_percen), 10)

wsr_normalized <- round((guarda$wsr_percen - min_wsr) / 
                          (max_wsr - min_wsr), 10)

guarda$normalized_wsr <- wsr_normalized
```

## Protected Areas

```{r}
max_protected <- round(max(prot_areas$protected), 10)
min_protected <- round(min(prot_areas$protected), 10)

protected_normalized <- round((prot_areas$protected - min_protected) / 
                                (max_protected - min_protected), 10)

prot_areas$normalized_protected <- protected_normalized
```

## Bandeira Reserves

```{r}
max_join <- round(max(bandeira$join_count), 10)
min_join <- round(min(bandeira$join_count), 10)

bandeira_normalized <- round((bandeira$join_count - min_join) / 
                               (max_join - min_join), 10)

bandeira$normalized_bandeira <- bandeira_normalized
```

## Ramsar Sites

```{r}
max_ramsar <- round(max(ramsar$ramsar_per), 10)
min_ramsar <- round(min(ramsar$ramsar_per), 10)

ramsar_normalized <- round((ramsar$ramsar_per - min_ramsar) / 
                            (max_ramsar - min_ramsar), 10)

ramsar$normalized_ramsar <- ramsar_normalized
```

## Merge Response Index Indicators

```{r}
response_normalized <- merge(heritage, atl_for_priority,
                             by = "objectid") %>% 
  select(objectid, name.x, surfline_n.x, 
         normalized_heritage, normalized_priority)

response_normalized <- merge(response_normalized, guarda,
                             by = "objectid") %>% 
  select(objectid, name.x, surfline_n.x, 
         normalized_heritage, normalized_priority, normalized_wsr)

response_normalized <- merge(response_normalized, prot_areas, 
                             by = "objectid") %>% 
  select(objectid, name.x, surfline_n.x, 
         normalized_heritage, normalized_priority, normalized_wsr, 
         normalized_protected)

response_normalized <- merge(response_normalized, bandeira,
                             by = "objectid") %>% 
  select(objectid, name.x, surfline_n.x, 
         normalized_heritage, normalized_priority, normalized_wsr, 
         normalized_protected, normalized_bandeira)

response_normalized <- merge(response_normalized, ramsar, 
                             by = "objectid") %>% 
  select(objectid, name.x, surfline_n.x, 
         normalized_heritage, normalized_priority, normalized_wsr, 
         normalized_protected, normalized_bandeira, normalized_ramsar)
```

## Normalized Response Index

```{r}
# add column called response_added 
response_normalized <- response_normalized %>% 
  mutate(response_added = round(response_normalized$normalized_heritage + response_normalized$normalized_priority +
                        response_normalized$normalized_wsr + response_normalized$normalized_protected +
                        response_normalized$normalized_bandeira + response_normalized$normalized_ramsar, 10))

max_response_added <- round(max(response_normalized$response_added), 10)
min_response_added <- round(min(response_normalized$response_added), 10)

response_normalized <- response_normalized %>% 
  mutate(response_index = round((response_normalized$response_added - min_response_added) /
                              (max_response_added - min_response_added), 10))
```

## Response Index Export

```{r}
write_csv(response_normalized, file = "normalized_response.csv")
```

# Surf Conservation Index

## Merge SCI Indices

```{r}
pressure_biod <- left_join(pressure_normalized, biodiversity_normalized,
                           by = "objectid") %>% 
  select(objectid, pressure_index, biodiversity_subindex)

press_biod_surf <- left_join(pressure_biod, surf_normalized,
                             by = "objectid") %>% 
  select(objectid, pressure_index, biodiversity_subindex,
         surf_subindex)

press_biod_surf_soc <- left_join(press_biod_surf, social_normalized,
                                 by = "objectid") %>% 
  select(objectid, pressure_index, biodiversity_subindex,
         surf_subindex, social_subindex)

all_indices <- left_join(press_biod_surf_soc, response_normalized,
                         by = "objectid") %>% 
  select(objectid, pressure_index, biodiversity_subindex,
         surf_subindex, social_subindex, response_index)
```

## Normalize SCI

```{r}
sci_normalized <- all_indices %>% 
  mutate(added_indices = round(pressure_index + biodiversity_subindex +
                                 surf_subindex + social_subindex +
                                 response_index, 10))

max_sci_added <- round(max(sci_normalized$added_indices), 10)
min_sci_added <- round(min(sci_normalized$added_indices), 10)

sci_normalized <- sci_normalized %>% 
  mutate(sci = round((added_indices - min_sci_added) /
                       (max_sci_added - min_sci_added), 10))
```

## Export SCI

```{r}
write_csv(sci_normalized, file = "sci.csv")
```
















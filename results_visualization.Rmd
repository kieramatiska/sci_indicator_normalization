---
title: "Results Visualization"
author: "Kort Alexander"
date: "2023-02-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(cowplot)
```

# Data input and wrangling

```{r}
surf_spots <- read_csv(here("data", "surf_spot_states", "surf_spot_states.csv"))
sci_w_climate_10km <- read_csv(here("sci_w_climate.csv")) %>% 
  select(id, sci) %>% 
  mutate(sci_10km = sci) %>% 
  select(-sci)
sci_wo_climate_10km <- read_csv(here("sci_wo_climate.csv")) %>% 
  select(id, sci) %>% 
  mutate(sci_wo_climate = sci) %>% 
  select(-sci)
sci_w_climate_5km <- read_csv(here("sci_w_climate_5km.csv")) %>% 
  select(id, sci) %>% 
  mutate(sci_5km = sci) %>% 
  select(-sci)
sci_w_climate_1km <- read_csv(here("sci_w_climate_1km.csv")) %>% 
  select(id, sci) %>% 
  mutate(sci_1km = sci) %>% 
  select(-sci)

# join sci to surf spots using id
surf_spots <- left_join(surf_spots, sci_w_climate_10km, by = "id", keep = FALSE) %>% 
  left_join(sci_w_climate_5km, by = "id", keep = FALSE) %>% 
  left_join(sci_w_climate_1km, by = "id", keep = FALSE) %>% 
  left_join(sci_wo_climate_10km, by = "id", keep = FALSE)


# filter for each region
surf_spots_nne <- surf_spots %>% 
  filter(region == "Norte" | region == "Nordeste")
surf_spots_se <- surf_spots %>% 
  filter(region == "Sudeste")
surf_spots_s <- surf_spots %>% 
  filter(region == "Sul")
```

# Distribution of priority

```{r}
# make histograms for all of Brazil and each region
hist_w_clim <- ggplot(data = surf_spots, aes(x = sci_10km)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  labs(x = "SCI", y = "Number of spots") +
  scale_y_continuous(limits = c(0, 160)) +
  theme_minimal()
hist_wo_clim <- ggplot(data = surf_spots, aes(x = sci_wo_climate)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  labs(x = "SCI", y = "Number of spots") +
  scale_y_continuous(limits = c(0, 160)) +
  theme_minimal()
hist_5km <- ggplot(data = surf_spots, aes(x = sci_5km)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  labs(x = "SCI", y = "Number of spots") +
  theme_minimal()
hist_1km <- ggplot(data = surf_spots, aes(x = sci_1km)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  labs(x = "SCI", y = "Number of spots") +
  theme_minimal()

hist_nne <- ggplot(data = surf_spots_nne, aes(x = sci_10km)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  scale_y_continuous(limits = c(0, 60)) +
  labs(x = "SCI", y = "Number of spots") +
  theme_minimal()
hist_se <- ggplot(data = surf_spots_se, aes(x = sci_10km)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  scale_y_continuous(limits = c(0, 60)) +
  labs(x = "SCI", y = "Number of spots") +
  theme_minimal()
hist_s <- ggplot(data = surf_spots_s, aes(x = sci_10km)) +
  geom_histogram(breaks = c(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1), fill = c("#d7191c", "#d7191c", "#fdae61", "#fdae61", "#a6d96a", "#a6d96a", "#1a9641", "#1a9641")) +
  scale_y_continuous(limits = c(0, 60)) +
  labs(x = "SCI", y = "Number of spots") +
  theme_minimal()
```

# Number of top spots in each state

```{r}
top_spots_by_state <- surf_spots %>% 
  group_by(state) %>% 
  summarize(count_10km = sum(sci_10km > 0.75), count_wo_clim = sum(sci_wo_climate > 0.75), count_5km = sum(sci_5km > 0.75), count_1km = sum(sci_1km > 0.75)) %>% 
  mutate(difference_5_10 = count_5km - count_10km) %>% 
  mutate(difference_1_10 = count_1km - count_10km) %>% 
  mutate(state = as.factor(state))

levels(top_spots_by_state$state) <- c("Pará", "Maranhão", "Ceará", "Rio Grande do Norte", "Paraíba", "Pernambuco", "Alagoas", "Sergipe", "Bahia", "Espírito Santo", "Rio de Janeiro", "São Paulo", "Paraná", "Santa Catarina", "Rio Grande do Sul")

states_w_clim <- ggplot(top_spots_by_state, aes(x = state, y = count_10km)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  scale_y_continuous(limits = c(0, 22)) +
  labs(x = "State", y = "Number of spots")

states_wo_clim <- ggplot(top_spots_by_state, aes(x = state, y = count_wo_clim)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  scale_y_continuous(limits = c(0, 22)) +
  labs(x = "State", y = "Number of spots")

states_5km <- ggplot(top_spots_by_state, aes(x = state, y = difference_5_10)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(x = "State", y = "Number of spots")

states_1km <- ggplot(top_spots_by_state, aes(x = state, y = difference_1_10)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(x = "State", y = "Number of spots")
```

# Join into figure

```{r}
figure <- plot_grid(hist_wo_clim, hist_w_clim, states_wo_clim, states_w_clim, labels = "AUTO", ncol = 2)

figure
```

